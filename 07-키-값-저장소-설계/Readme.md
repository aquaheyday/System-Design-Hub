## 키-값 저장소 설계
키-값 저장소(key-value store)는 비 관계형(non-relational) 데이터베이스이다. 이 저장소에 저장되는 값은 고유 식별자(identifier)를 키로 가져야 한다. 키와 값 사이의 연결 관계를 "키-값" 쌍(pair)라고 지칭한다.  
키-값 쌍에서의 키는 유일해야 하며 해당 키에 매달린 값은 키를 통해서만 접근할 수 있다. 키는 일반 텍스트일 수도 있고 해시 값일 수도 있다. 성능상의 이유로 키는 짧을수록 좋다.
- 일반 텍스트 키: "last_logged_in_at"
- 해시 키: 253DDEC4

| 키 | 값 |
|----------|----------|
| 145 | john |
| 147 | bob |

키-값 쌍에서의 값은 문자열,리스트(list),객체(object)일 수도 있다. 보통 값으로 무엇이 오든 상관하지 않는다. 키-값 저장소로 널리 알려진 것은 아마존 다이나모, memcached, 레디스 등이 있다.
- put(key, value): 키-값 쌍을 저장소에 저장한다.
- get(key): 인자로 주어진 키에 매달린 값을 가져온다.

## 단일 서버 키-값 저장소
가장 직관적인 방법은 키-값 쌍 전부를 메모리에 해시 테이블로 저장하는 것이다. 그러나 이 접근법은 빠른 속도를 보장하긴 하지만 모든 데이터를 메모리 안에 두는 것이 불가능할 수도 있다는 약점을 가지고 있다. 
이 문제를 해결하기 위한 개선책으로는 
- 데이터 압축(compression)
- 자주 쓰이는 데이터만 메모리에 두고 나머지는 디스크에 저장
그러나 이렇게 개선한다 해도, 한 대의 서버로 부족한 때가 찾아온다. 많은 데이터를 저장하면 분산 키-값 저장소(distributed key-value store)를 만들 필요가 있다.

## 분산 키-값 저장소
분산 키-값 저장소는 분산 해시 테이블이라고도 불린다. 키-값 쌍을 여러 서버에 분산시키는 탓이다. 분산 시스템을 설꼐할 때는 CAP 정리(Consistency, Availability, Partition Tolerance theorem)을 이해하고 있어야 한다.

### CAP 정리
CAP 정리는 데이터 일관성(consistency), 가용성(availability), 파티션 감내(partition tolerance)라는 세 가지 요구사항을 동시에 만족하는 분산 시스템을 설계하는 것은 불가능하다는 정리다.
- 데이터 일관성: 분산 시스템에 접속하는 모든 클라이언트는 어떤 노드에 접속했느냐에 관계없이 언제나 같은 데이터를 보게 되어야 한다.
- 가용성: 분산 시스템에 접속하는 클라이언트는 일부 노드에 장애가 발생하더라도 항상 응답을 받을 수 있어야 한다.
- 파티션 감내: 파티션은 두 노드 사이에 통신 장애가 발생하였음을 의미한다. 파티션 감내는 네트워크에 파티션이 생기더라도 시스템은 계속 동작하여야 한다는 것을 뜻한다.
- 
![Image](/drawio/CAP-정리.drawio.png)

CAP 정리는 이들 가운데 어떤 두 가지를 충족하려면 나머지 하나는 반드시 희생되어야 한다는 것을 의미한다.

- CP 시스템: 일관성과 파티션 감내를 지원하는 키-값 저장소
- AP 시스템: 가용성과 파티션 감내를 지원하는 키-값 저장소
- CA 시스템: 일관성과 가용성을 지원하는 키-값 저장소. 통상 네트워크 장애는 피할 수 없는 일로 여겨지므로, 분산 시스템은 반드시 파티션 문제를 감내할 수 있도록 설계되어야 한다. 그러므로 실세계에 CA 시스템은 존재하지 않는다.
